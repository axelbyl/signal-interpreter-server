import sys
import os
from unittest.mock import patch
from src.main import main
from src.routes import signal_interpreter_app


CURR_DIR = os.path.abspath(os.path.dirname(__file__))
FIXTURE_path = os.path.join(CURR_DIR, "tests", "integration", "fixtures", "test_basic.json")

@patch.object(sys, "argv" ,["main" ,"--file_path" ,FIXTURE_path])
@patch.object(signal_interpreter_app, "run")
def test_call_response(mock_run, mock_path):
    signal_interpreter_app.testing = True
    signal_interpreter_app_instance = signal_interpreter_app.test_client()
    main()
    with signal_interpreter_app_instance as client:
        my_payload = {"signal": "11"}
        response = client.post("/", json=my_payload)
        assert response.get_json() == "ECU Reset"



